{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="pt-br">
  <body>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capizzas</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <header class="header">
        <div class="logo">
            <a href="{% url 'base' %}">
                <img src="/media/pizzas/capizzas.png" alt="Capizzas">
            </a>
        </div>
        <nav>
            <a href="{% url 'cardapio' %}">Card√°pio</a>
            <a href="#">Promo√ß√µes</a>
            <a href="{% url 'localizacao' %}">Localiza√ß√£o</a>
            <a href="{% url 'sobre' %}">Sobre</a>
            <a href="{% url 'cadastropizza' %}">Fa√ßa seu pedido</a>
            <a href="{% url 'carrinho' %}" style="color: white; text-decoration: none; position: relative;">Fazer pedido</a> 
            {% if user.is_authenticated %}
            Ol√°, {{ user.username }}!
            <form action="{% url 'logout' %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="login-btn" style="background:none; border:none; color:inherit; cursor:pointer;">
            Logout
            </button>
            </form>
            {% else %}
            <a href="{% url 'login' %}" class="login-btn">Login</a>
            {% endif %}  
        </nav>
    </header>
  
<div class="cadastro-wrapper-coluna">
        <!-- Formul√°rio de cadastro -->
        <div class="registro-container">
            <h2>Cadastrar Pizza</h2>
            {% if error %}
            <p class="error">{{ error }}</p>
            {% endif %}
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit">Registrar</button>
            </form>
        </div>

        <!-- Lista de pizzas -->
        <div class="lista-pizzas">
            <h2>Pizzas Cadastradas</h2>

            <input type="text" id="filtro" placeholder="üîç Buscar pizza..." class="filtro-input">

            <ul id="lista-pizzas">
                {% for pizza in pizzas %}
                <li class="pizza-item">
                    <strong>{{ pizza.nome }}</strong><br>
                    {{ pizza.ingredientes }}<br>
                    R$ {{ pizza.preco }}<br>
                    {% if pizza.imagem %}
                    <img src="{{ pizza.imagem.url }}" alt="{{ pizza.nome }}" width="100"><br>
                    {% endif %}
                    <div class="acoes-pizza">
                        <a href="{% url 'editar_pizza' pizza.id %}" class="btn-editar">‚úèÔ∏è Editar</a>
                        <a href="{% url 'excluir_pizza' pizza.id %}" class="btn-excluir" onclick="return confirm('Tem certeza que deseja excluir esta pizza?')">üóëÔ∏è Excluir</a>
                    </div>
                </li>
                {% empty %}
                <li>Nenhuma pizza cadastrada.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <footer>
        <div class="social-icons">
            <a href="https://www.tiktok.com" target="_blank"><img src="/media/pizzas/tiktok.png" alt="TikTok"></a>
            <a href="https://www.facebook.com" target="_blank"><img src="/media/pizzas/facebook.png" alt="Facebook"></a>
            <a href="https://www.instagram.com" target="_blank"><img src="/media/pizzas/instagram.png" alt="Instagram"></a>
        </div>
        <div class="last-update">√öltima atualiza√ß√£o: Junho de 2025</div>
    </footer>

    <script>
        const filtro = document.getElementById("filtro");
        const lista = document.getElementById("lista-pizzas");

        filtro.addEventListener("keyup", function () {
            const termo = filtro.value.toLowerCase();
            const itens = lista.getElementsByTagName("li");

            Array.from(itens).forEach(function (item) {
                const texto = item.textContent.toLowerCase();
                item.style.display = texto.includes(termo) ? "" : "none";
            });
        });
    </script>
    {% endblock %}
</body>
</html>